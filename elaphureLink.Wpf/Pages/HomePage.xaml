<UserControl
    x:Class="elaphureLink.Wpf.Pages.HomePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:elaphureLink.Wpf.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    xmlns:language="clr-namespace:elaphureLink.Wpf.Properties.i18n"
    DataContext="{Binding HomePageViewModel, Source={StaticResource ViewModelLocator}}"
    d:DesignHeight="500"
    d:DesignWidth="800"
    mc:Ignorable="d">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Title -->
        <StackPanel Grid.Row="0" Margin="0,0,0,5" Orientation="Vertical">
            <TextBlock
                HorizontalAlignment="Center"
                FontFamily="Century Gothic"
                FontSize="48"
                Text="{x:Static language:lang.elaphureLink}" />
            <TextBlock
                HorizontalAlignment="Center"
                FontFamily="Century Gothic"
                FontSize="16"
                Text="{x:Static language:lang.keilWirelessProxy}" />
        </StackPanel>

        <!-- Busy bar -->
        <ui:ProgressBar
            Grid.Row="1"
            Margin="0,0,0,10"
            VerticalAlignment="Center"
            IsIndeterminate="True">
            <ui:ProgressBar.Visibility>
                <MultiBinding Converter="{StaticResource MultiBooleanToVisibilityConverter}">
                    <Binding Path="InstallDriverCommand.IsRunning" />
                    <Binding Path="StartProxyCommand.IsRunning" />
                </MultiBinding>
            </ui:ProgressBar.Visibility>
        </ui:ProgressBar>

        <!-- Main content -->
        <Grid Grid.Row="2" VerticalAlignment="Top">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="6*" />
                <ColumnDefinition Width="2*" />
            </Grid.ColumnDefinitions>

            <ui:SimpleStackPanel
                Grid.Column="1"
                Orientation="Vertical"
                Spacing="12"
                Style="{StaticResource ControlPageContentPanelStyle}">

                <!-- 1) Scan devices (button MUST be visible) -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               VerticalAlignment="Center"
                               FontSize="16"
                               Text="扫描设备" />

                    <!-- Put controls in * column, right aligned, avoid Auto column squeeze -->
                    <Grid Grid.Column="1" HorizontalAlignment="Right">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="220"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                MinWidth="64"
                                Margin="0,0,8,0"
                                Padding="12,6"
                                Command="{Binding ScanDevicesCommand}"
                                Content="扫描"
                                IsEnabled="{Binding IsScanning, Converter={StaticResource BooleanInverseConverter}}" />

                        <ComboBox Grid.Column="1"
                                  Width="220"
                                  DisplayMemberPath="Display"
                                  IsEnabled="{Binding HasDiscoveredDevices}"
                                  ItemsSource="{Binding DiscoveredDevices}"
                                  SelectedItem="{Binding SelectedDevice, Mode=TwoWay}" />
                    </Grid>
                </Grid>

                <!-- 2) Device address -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock VerticalAlignment="Center"
                               FontSize="16"
                               Text="{x:Static language:lang.deviceIPAddress}" />

                    <TextBox Grid.Column="1"
                             MinWidth="260"
                             HorizontalAlignment="Right"
                             ui:ControlHelper.PlaceholderText="dap.local"
                             IsEnabled="{Binding IsProxyStart, Converter={StaticResource BooleanInverseConverter}}"
                             Text="{Binding deviceAddress, UpdateSourceTrigger=PropertyChanged}" />
                </Grid>

                <!-- Log level -->
                <Grid>
                    <TextBlock VerticalAlignment="Center"
                               FontSize="16"
                               Text="{x:Static language:lang.logLevel}" />
                    <ComboBox x:Name="Combo2"
                              Width="150"
                              HorizontalAlignment="Right"
                              SelectedIndex="2">
                        <sys:String>Debug</sys:String>
                        <sys:String>Info</sys:String>
                        <sys:String>Warning</sys:String>
                        <sys:String>Error</sys:String>
                        <sys:String>Silent</sys:String>
                    </ComboBox>
                </Grid>

                <!-- Install driver -->
                <Grid>
                    <TextBlock VerticalAlignment="Center"
                               FontSize="16"
                               Text="{x:Static language:lang.installKeilDriver}" />
                    <Button HorizontalAlignment="Right"
                            Command="{Binding InstallDriverButtonCommand}"
                            Content="{x:Static language:lang.install}"
                            IsEnabled="{Binding InstallDriverCommand.IsRunning, Converter={StaticResource BooleanInverseConverter}}" />
                </Grid>

                <!-- Vendor command -->
                <Grid>
                    <TextBlock VerticalAlignment="Center"
                               FontSize="16"
                               Text="{x:Static language:lang.enableVendorCommand}" />
                    <ui:ToggleSwitch x:Name="vendorCommandToggleSwitch"
                                     Width="41"
                                     HorizontalAlignment="Right"
                                     IsOn="{Binding EnableVendorCommand}" />
                </Grid>

                <!-- Start proxy -->
                <Grid>
                    <TextBlock VerticalAlignment="Center"
                               FontSize="16"
                               Text="{x:Static language:lang.startProxy}" />
                    <ui:ToggleSwitch x:Name="toggleSwitch"
                                     Width="41"
                                     HorizontalAlignment="Right"
                                     IsEnabled="{Binding StartProxyCommand.IsRunning, Converter={StaticResource BooleanInverseConverter}}"
                                     IsOn="{Binding IsProxyStart}" />
                </Grid>

            </ui:SimpleStackPanel>
        </Grid>
    </Grid>
</UserControl>
